/////////////////// Autenticación en MSSQL ///////////////////

Regularmente la segurdad comienza a nivel de servidor (los roles a nivel de servidor facilitan la admistracion de permisos), y los usuarios deben autenticarse.
La seguridad en la base de datos:
- Permite que alguien o algo pueda acceder a un recurso para que se realice una o mas aciones en el.
- Las arquitecturas estan jerarquizadas para facilitar la administracion de permisos.
- Los permisos se heredan.

Cada inicio de sesion tiene un rol determinado para poder gestionar ciertas tareas y permisos.
Los tipos de inicio de sesion son:
- Windows (por defecto)
- SQL Server
- Mixto

Para cambiar el tipo de inicio de sesion en el servidor SQL Server, tienes que abrir SSMS, ir a 'Esplorador de objetos > (clic derecho) Instancia del servidor > Propiedades', en el panel que se abre ir a la seccion 'Seguridad > Autenticacion del servidor' y seleccionar el metodo que se prefiera.
Despues, es necesario reiniciar el servidor SQL.
Para esto, se debe abrir el Administrsdos de tareas e ir hacia 'Servicios > Abrir servicios', buscar la instancia de SQL y dar clic en reiniciar.
O tambien abriendo SQL Server Configuration Manager, dirigirnos a 'SQL Server Services' y dar clic derecho en la instancia que queremos reiniciar y dar clic en 'Restart'.

Acceso a la base de datos
- Los inicios de sesion no se pueden conectar a la base de datos, hay que crear un usuario de bases de datos para ello.
- A cada usuario se le debe asignar un inicio de sesion.
- Los esquemas son espacios de nombres para organizar objetos en la base de datos (como secciones o archiveros donde se guardan las tablas de la base de datos).
- Si no se especifica esquema, se asigna al usuario dbo.

Usuarios
- dbo: puede realizar cualquier accion en la base de datos y no se puede eliminar (es como el db owner).
- Gest: no puede ser eliminado, pero si deshabilitado, revocando los permisos de conexion.
- Cuenta SA (Super usuario): Esta suele ser el objetivo de atacantes, no se debe habilitar a menos que se necesite, y se debe colocar una contraseña compleja.


Los roles del servidor se utilizan para control de acceso a los recursos y se organizan como jerarquia. 
- sysadmin: este rol tiene control completo del servidor:
	- El nombre debe ser corto y en minusculas
	- La seguridad disminuye si se crea mas de un sysadmin

/////////////////// Gestionar Inicio de sesión ///////////////////

Para crear un login/inicion de sesion, hay dos maneras en las que podemos realizarlo:
- Nos dirigimos al 'Explorador de objetos > Seguridad > (clic derecho) Inicios de sesion > Nuevo inicio de sesion'. Esto nos abrira una ventana de configuracion del inicio de sesion. 
Aqui debemos asignarle un nombre al inicio de sesion y el metodo por el cual se debe iniciar sesion. Tambien podemos habilitar/deshabilitar el inicio de sesion y asignar los roles. Asi como asignar usuarios a este inicio de sesion.

-Tambien se puede crear por medio de TSQL:
Crear un inicio de sesion con autenticacion de SQL Server
    ->  CREATE LOGIN nombre_login
        WITH PASSWORD = 'contraseña_segura';
Crear un inicio de sesion con autenticacion de Windows
    ->  CREATE LOGIN [DOMINIO\nombre_usuario]
        FROM WINDOWS;
Modificar un inicio de sesion
    ->  ALTER LOGIN nombre_login
        WITH PASSWORD = 'nueva_contraseña_segura';
Eliminar un inicio de sesion
    ->  DROP LOGIN nombre_login
Ver los inicios de sesion existentes
    ->  SELECT *
        FROM sys.sql_logins;

NOTA: Es importante saber que estos inicios de sesion solo sirven para conectarse a la base de datos, no para manipular nuestras bases de datos.

/////////////////// Gestionar usuarios de base de datos ///////////////////

Para crear un usuario de base de datos por medio de TSQL, se puede hacer de la siguiente manera:
Crear un usuario de base de datos
    ->  CREATE USER nombre_usuario
        FOR LOGIN nombre_login;
Modificar un usuario
    ->  ALTER USER nombre_usuario
        WITH LOGIN = otro_login;
Ver los usuarios de base de datos existentes
    ->  SELECT *
        FROM sys.database_principals
        WHERE type = 'S'; -- Filtrar solo los usuarios de base de datos
Eliminar un usuario de base de datos
    ->  DROP USER nombre_usuario;

Para ver los usuarios dentro de SSMS debes ir a 'Esplorador de objetos >  Bases de datos > base_de_datos_a_explorar > Seguridad > Usuarios'.
Si ahi mismo das clic derecho, se abrira la ventana donde puedes crear un nuevo usuario para esa base de datos.
Aqui podras agregar los datos como el nombre del usuario, el inicio de sesion al que se le asignara este usuario, el esquema por defecto, y los roles de base de datos a los que pertenecera este usuario.


NOTA: La creacion del login permite al usuario conectarse al servidor, pero no a las bases de datos.
Para que un usuario pueda conectarse a una base de datos, es necesario crear un usuario de base de datos y asignarle un inicio de sesion.
Un usuario de base de datos debe pertenecer a un inicio de sesion.































